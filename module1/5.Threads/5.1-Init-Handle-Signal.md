## 镜像的启动命令要选择好，进程可以处理 SIGTERM 信号

- kill -9 1 在容器中是不工作的，内核阻止了 1 号进程对 SIGKILL 特权信号的响应。
- kill 1 分两种情况，如果 1 号进程没有注册 SIGTERM 的 handler，那么对 SIGTERM 信号也不响应，如果注册了 handler，那么就可以响应 SIGTERM 信号。

看一个例子，一个应用分别使用 3 种 init 进程方法：shell、go、tini 启动，看看是否可以正确处理信号量

[shell as init](./init-handle-signal/Dockerfile-shell)

[golang as init](./init-handle-signal/Dockerfile-go)

[tiny as init](./init-handle-signal/Dockerfile-tiny)

### 1. init 进程：shell(SIGKILL -> 缺省, SIGTERM -> 忽略)

```shell
# docker run --name shell-app -d init-handle-signal:shell
# docker exec -it shell-app sh
/ # ps -ef
PID   USER     TIME  COMMAND
    1 root      0:00 /bin/sh ./run.sh
    6 root      0:00 ./init-handle-signal
   13 root      0:00 sh
   19 root      0:00 ps -ef

/ # kill -9 1
/ # ps -ef
PID   USER     TIME  COMMAND
    1 root      0:00 /bin/sh ./run.sh
    6 root      0:00 ./init-handle-signal
   13 root      0:00 sh
   19 root      0:00 ps -ef

/ # kill 1
/ # ps -ef
PID   USER     TIME  COMMAND
    1 root      0:00 /bin/sh ./run.sh
    6 root      0:00 ./init-handle-signal
   13 root      0:00 sh
   19 root      0:00 ps -ef
```

**_kill -9 信号量(SIGKILL)无法被正确处理，kill 信号量(SIGTERM)无法被正确处理_**

### 2. init 进程：golang(SIGKILL -> 缺省, SIGTERM -> 捕获)

```shell
# docker run --name golang-app -d init-handle-signal:golang
# docker exec -it golang-app sh
/ # ps -ef
PID   USER     TIME  COMMAND
    1 root      0:00 ./init-handle-signal
   14 root      0:00 sh
   20 root      0:00 ps -ef

/ # kill -9 1
/ # ps -ef
PID   USER     TIME  COMMAND
    1 root      0:00 ./init-handle-signal
   14 root      0:00 sh
   20 root      0:00 ps -ef

/ # kill 1
/ # %

```

**_kill -9 信号量无法被正确处理，kill 信号量可以正确被处理_**

### 3. init 进程：tini(SIGKILL -> 缺省, SIGTERM -> 捕获)

```shell
# docker run --name app-tini -d goharbor.com/demo/discovery-service:tini
# docker exec -it app-tini sh
/ # ps -ef
xxx

/ # kill -9 1
/ # ps -ef
xxx

/ # kill 1
/ # %
```

**_kill -9 信号量无法被正确处理，kill 信号量可以正确被处理_**

### 结论，如果可以确认业务容器的 init 进程（1 号进程）可以处理 SIGTERM 信号（15），那么可以使用业务进程作为 init 进程；如果无法确认使用 tini 作为 init 进程，就像上面例子的一样
