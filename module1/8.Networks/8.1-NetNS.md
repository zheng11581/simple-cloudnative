### 现象：

已经启动的容器, 无法修改其网络参数（/proc/sys/net）？

### 原因：

- 容器里 Network Namespace 的网络参数并不是完全从宿主机 Host Namespace 里继承的，也不是完全在新的 Network Namespace 建立的时候重新初始化的
- 容器中"/proc/sys/"是只读 mount 的，那么在容器里是不能修改"/proc/sys/net/"下面的任何参数了

### 知识理解：

```shell
# docker run -d --name net_param swr.cn-north-4.myhuaweicloud.com/pixiu-public/centos:centos7.9.2009 sleep 3600
# docker exec -it net_param bash

# echo 1 > /proc/sys/net/ipv4/ip_forward
bash: /proc/sys/net/ipv4/ip_forward: Read-only file system

# cat /proc/mounts | grep "/proc/sys/"
proc /proc/sys proc ro,nosuid,nodev,noexec,relatime 0 0
proc /proc/sysrq-trigger proc ro,nosuid,nodev,noexec,relatime 0 0

```

### 问题解决

- 可以通过在容器启动时，添加 "--sysctl" 参数

```shell
# docker stop net_param; docker rm net_param
# docker run -d --name net_param --sysctl "net.ipv4.ip_forward=1" swr.cn-north-4.myhuaweicloud.com/pixiu-public/centos:centos7.9.2009 sleep 3600

# docker exec -it net_param bash
# cat /proc/sys/net/ipv4/ip_forward
1
```

- 通过 `lsns` `nsenter` 暴力修改容器网络参数

```shell
# lsns -t net | grep sleep
4026532265 net       1  1931 root          0 /run/docker/netns/027d20907d8d sleep 3600

# nsenter -t 1931 -n "echo 1 > /proc/sys/net/ipv4/ip_forward"

```
