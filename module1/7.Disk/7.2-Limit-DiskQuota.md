### 现象：

为什么容器会把宿主机的磁盘写满？

### 原因：

在容器中对于 OverlayFS 中写入数据, 其实就是往宿主机的一个目录（upperdir）里写数据

```shell
# make image
# docker run -it --rm --name fio registry/fio:v1 bash
# df -h
Filesystem      Size  Used Avail Use% Mounted on
overlay         124G  4.7G  113G   4% /

# dd if=/dev/zero of=./test.log bs=4096 count=262144
262144+0 records in
262144+0 records out
1073741824 bytes (1.1 GB) copied, 7.14879 s, 150 MB/s

# df -h
Filesystem      Size  Used Avail Use% Mounted on
overlay         124G  5.7G  112G   5% /

# 宿主机
# cat /proc/mounts |grep overlay
overlay /var/lib/docker/overlay2/5faf7b25452b56a85009568f6f3236cb7172ed628bbea52943ad14780bce801b/merged overlay rw,relatime,lowerdir=/var/lib/docker/overlay2/l/XGIY7W6EUXFKT7Q2MNO7AI4RKI:/var/lib/docker/overlay2/l/MWKQA24IDUBJVQ45ZFOHGWVXFA:/var/lib/docker/overlay2/l/R5LEVPOVWXPIIIEPQBOD7JCMQ4,upperdir=/var/lib/docker/overlay2/5faf7b25452b56a85009568f6f3236cb7172ed628bbea52943ad14780bce801b/diff,workdir=/var/lib/docker/overlay2/5faf7b25452b56a85009568f6f3236cb7172ed628bbea52943ad14780bce801b/work,xino=off 0 0

# cd /var/lib/docker/overlay2/5faf7b25452b56a85009568f6f3236cb7172ed628bbea52943ad14780bce801b/diff
# ls -lh
total 1.1G
-rw-r--r-- 1 root root 1.1G Jun 22 10:20 test.log


```

### 解决方法：

- 对 OverlayFS 的 upperdir 目录做 XFS Quota 的限流

```shell
# docker stop fio; docker rm fio
# docker run --storage-opt size=10M -it --rm --name fio registry/fio:v1 bash
# df -h
Filesystem      Size  Used Avail Use% Mounted on
overlay         10M  8.0K   9.9M   1% /

```
