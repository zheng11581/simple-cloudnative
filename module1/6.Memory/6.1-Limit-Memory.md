### 现象：

- 容器内的进程为什么被杀了？

### 原因：

- OOM-Kill

1. 容器里所有进程使用的内存量，超过了容器所在 Memory Cgroup 里的内存限制。这时 Linux 系统就会主动杀死容器中的一个进程，往往这会导致整个容器的退出

2. 用系统总的可用页面数，去乘以 OOM 校准值 `oom_score_adj`，再加上进程已经使用的物理页面数（`rss`），计算出来的值越大，那么这个进程被 OOM Kill 的几率也就越大

- Memory Cgroup
  - memory.limit_in_bytes：直接限制这个控制组内所有进程能使用的内存最大值
  - memory.oom_control：OOM 控制，1 表示不希望触发 OOM-Kill，0 启用 OOM-Kill
  - memory.usage_in_bytes：只读参数，显示当前控制组内所有进程实际用了多少内存；这个数值越接近 memory.limit_in_bytes，触发 OOM 的风险就越高

### 知识理解：

```shell
# cd oom
# make image
# ./start_container.sh

# 容器启动后，里面有一个小程序 mem_alloc 会不断地申请内存。当它申请的内存超过 512MB 的时候，你就会发现，我们启动的这个容器消失了

```
